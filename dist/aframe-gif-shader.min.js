(()=>{var e={580:(e,t)=>{t.v=function(e,t,s){var a=0,r=[],i=0,_=null,n=null,h=[],o=0;if(71!==e[0]||73!==e[1]||70!==e[2]||56!==e[3]||57!==e[4]&&55!==e[4]||97!==e[5])s&&s("parseGIF: no GIF89a");else{a+=13+ +!!(128&e[10])*Math.pow(2,1+(7&e[10]))*3;for(var l=e.subarray(0,a);e[a]&&59!==e[a];){var c=a,d=e[a];if(33===d){var u=e[++a];if(-1===[1,254,249,255].indexOf(u)){s&&s("parseGIF: unknown label");break}for(249===u&&r.push(10*(e[a+3]+(e[a+4]<<8))),255===u&&(o=e[a+15]+(e[a+16]<<8));e[++a];)a+=e[a];249===u&&(_=e.subarray(c,a+1))}else{if(44!==d){s&&s("parseGIF: unknown blockId");break}for(a+=9,a+=1+ +!!(128&e[a])*(3*Math.pow(2,1+(7&e[a])));e[++a];)a+=e[a];n=e.subarray(c,a+1);var f={disposalMethod:_[3],blob:URL.createObjectURL(new Blob([l,_,n]))};h.push(f)}a++}}if(h.length){var p=document.createElement("canvas"),m=function(e){var s=new Image;s.onload=function(e,s){i++,h[s]=this,i===h.length?(p=null,t&&t(r,o,h)):m(++s)}.bind(s),s.src=p.toDataURL("image/gif")};!function(){for(var e=0;e<h.length;e++){var t=new Image;t.onload=function(e,s){0===s&&(p.width=t.width,p.height=t.height),i++,h[s]=this,i===h.length&&(i=0,m(1))}.bind(t,null,e),t.src=h[e].blob,t.disposalMethod=h[e].disposalMethod}}()}}}},t={};function s(a){var r=t[a];if(void 0!==r)return r.exports;var i=t[a]={exports:{}};return e[a](i,i.exports,s),i.exports}(()=>{"use strict";var e=s(580);if("undefined"==typeof AFRAME)throw"Component attempted to register before AFRAME was available.";const{parseUrl:t}=AFRAME.utils.srcLoader,{debug:a}=AFRAME.utils;a.enable("shader:gif:warn");const r=a("shader:gif:warn"),i=a("shader:gif:debug"),_={};function n(e,t){return{status:"error",src:t,message:e,timestamp:Date.now()}}AFRAME.registerShader("gif",{schema:{color:{type:"color"},fog:{default:!0},src:{default:null},autoplay:{default:!0}},init(e){return i("init",e),i(this.el.components),this.__cnv=document.createElement("canvas"),this.__cnv.width=2,this.__cnv.height=2,this.__ctx=this.__cnv.getContext("2d"),this.__texture=new THREE.Texture(this.__cnv),e.repeat&&(this.__texture.wrapS=THREE.RepeatWrapping,this.__texture.wrapT=THREE.RepeatWrapping,this.__texture.repeat.set(e.repeat.x,e.repeat.y)),this.__material={},this.__reset(),this.material=new THREE.MeshBasicMaterial({map:this.__texture}),this.el.sceneEl.addBehavior(this),this.material},update(e){return i("update",e),this.__updateMaterial(e),this.__updateTexture(e),this.material},tick(e){this.__frames&&!this.paused()&&Date.now()-this.__startTime>=this.__nextFrameTime&&this.nextFrame()},__updateMaterial(e){const{material:t}=this,s=this.__getMaterialData(e);Object.keys(s).forEach((e=>{t[e]=s[e]}))},__getMaterialData:e=>({fog:e.fog,color:new THREE.Color(e.color)}),__setTexure(e){i("__setTexure",e),"error"===e.status?(r(`Error: ${e.message}\nsrc: ${e.src}`),this.__reset()):"success"===e.status&&e.src!==this.__textureSrc&&(this.__reset(),this.__ready(e))},__updateTexture(e){const{src:t,autoplay:s}=e;"boolean"==typeof s?this.__autoplay=s:void 0===s&&(this.__autoplay=!0),this.__autoplay&&this.__frames&&this.play(),t?this.__validateSrc(t,this.__setTexure.bind(this)):this.__reset()},__validateSrc(e,s){const a=t(e);if(a)return void this.__getImageSrc(a,s);let r;const i=this.__validateAndGetQuerySelector(e);if(i&&"object"==typeof i){if(i.error)r=i.error;else{const t=i.tagName.toLowerCase();if("video"===t)e=i.src,r="For video, please use `aframe-video-shader`";else{if("img"===t)return void this.__getImageSrc(i.src,s);r=`For <${t}> element, please use \`aframe-html-shader\``}}if(r){const t=_[e],a=n(r,e);t&&t.callbacks?t.callbacks.forEach((e=>e(a))):s(a),_[e]=a}}},__getImageSrc(t,s){if(t===this.__textureSrc)return;let a=_[t];if(a&&a.callbacks){if(a.src)return void s(a);if(a.callbacks)return void a.callbacks.push(s)}else a=_[t]={callbacks:[]},a.callbacks.push(s);const r=new Image;function i(e){const s=n(e,t);a.callbacks&&(a.callbacks.forEach((e=>e(s))),_[t]=s)}r.crossOrigin="Anonymous",r.addEventListener("load",(s=>{this.__getUnit8Array(t,(s=>{s?(0,e.v)(s,((e,s,r)=>{const i={status:"success",src:t,times:e,cnt:s,frames:r,timestamp:Date.now()};a.callbacks&&(a.callbacks.forEach((e=>e(i))),_[t]=i)}),(e=>i(e))):i("This is not gif. Please use `shader:flat` instead")}))})),r.addEventListener("error",(e=>i("Could be the following issue\n - Not Image\n - Not Found\n - Server Error\n - Cross-Origin Issue"))),r.src=t},__getUnit8Array(e,t){if("function"!=typeof t)return;const s=new XMLHttpRequest;s.open("GET",e),s.responseType="arraybuffer",s.addEventListener("load",(e=>{const s=new Uint8Array(e.target.response),a=s.subarray(0,4);let r="";for(let e=0;e<a.length;e++)r+=a[e].toString(16);"47494638"===r?t(s):t()})),s.addEventListener("error",(e=>{i(e),t()})),s.send()},__validateAndGetQuerySelector(e){try{return document.querySelector(e)||{error:"No element was found matching the selector"}}catch(e){return{error:"no valid selector"}}},pause(){i("pause"),this.__paused=!0},play(){i("play"),this.__paused=!1},togglePlayback(){this.paused()?this.play():this.pause()},paused(){return this.__paused},nextFrame(){for(this.__draw();Date.now()-this.__startTime>=this.__nextFrameTime;)this.__nextFrameTime+=this.__delayTimes[this.__frameIdx++],(this.__infinity||this.__loopCnt)&&this.__frameCnt<=this.__frameIdx&&(this.__frameIdx=0)},__clearCanvas(){this.__ctx.clearRect(0,0,this.__width,this.__height),this.__texture.needsUpdate=!0},__draw(){if(0!=this.__frameIdx){const e=this.__frames[this.__frameIdx-1];8!=e.disposalMethod&&9!=e.disposalMethod||this.__clearCanvas()}else this.__clearCanvas();const e=this.__frames[this.__frameIdx];void 0!==e&&(this.__ctx.drawImage(e,0,0,this.__width,this.__height),this.__texture.needsUpdate=!0)},__ready({src:e,times:t,cnt:s,frames:a}){i("__ready"),this.__textureSrc=e,this.__delayTimes=t,s?this.__loopCnt=s:this.__infinity=!0,this.__frames=a,this.__frameCnt=t.length,this.__startTime=Date.now(),this.__width=THREE.Math.floorPowerOfTwo(a[0].width),this.__height=THREE.Math.floorPowerOfTwo(a[0].height),this.__cnv.width=this.__width,this.__cnv.height=this.__height,this.__draw(),this.__autoplay?this.play():this.pause()},__reset(){this.pause(),this.__clearCanvas(),this.__startTime=0,this.__nextFrameTime=0,this.__frameIdx=0,this.__frameCnt=0,this.__delayTimes=null,this.__infinity=!1,this.__loopCnt=0,this.__frames=null,this.__textureSrc=null}})})()})();
//# sourceMappingURL=aframe-gif-shader.min.js.map